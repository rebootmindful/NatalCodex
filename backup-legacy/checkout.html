<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NatalCodex - Checkout</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#0a0e27 0%,#1a1f4d 50%,#2d1f4d 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center}
    .card{width:520px;max-width:92vw;background:rgba(10,14,39,.6);backdrop-filter:blur(10px);border:1px solid rgba(0,255,157,.3);border-radius:16px;padding:24px;box-shadow:0 10px 28px rgba(0,255,157,.18)}
    .title{font-size:22px;font-weight:700;margin-bottom:8px;color:#e5e7eb}
    .desc{font-size:14px;color:#cbd5e1;margin-bottom:18px;line-height:1.8}
    .field{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
    label{font-size:13px;color:#cbd5e1}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,255,157,.25);background:rgba(2,6,23,.65);color:#fff;outline:none}
    input:focus{border-color:#00ff9d;box-shadow:0 0 0 3px rgba(0,255,157,.18)}
    .actions{display:flex;gap:12px;margin-top:18px}
    .btn{flex:1;display:inline-flex;align-items:center;justify-content:center;padding:14px 18px;border-radius:12px;border:1px solid rgba(0,255,157,.35);background:linear-gradient(135deg,#00ff9d 0%,#00d4aa 100%);color:#0a0e27;font-weight:700;letter-spacing:.2px;box-shadow:0 10px 26px rgba(0,255,157,.4);cursor:pointer;transition:transform .2s ease}
    .btn:hover{transform:translateY(-2px)}
    .ghost{background:rgba(10,14,39,.45);color:#e5e7eb;border:1px solid rgba(0,255,157,.35)}
    .note{font-size:12px;color:#a1a1aa;margin-top:10px}
  </style>
  </head>
<body>
  <div class="card">
    <div class="title">Unlock Full Generation</div>
    <div class="desc">Enter your email and proceed to checkout. After payment, you will be redirected to the birth information page to generate your Soul Codex Card and the in-depth report.</div>
    <div class="field">
      <label>Email</label>
      <input id="email" type="email" placeholder="you@example.com">
    </div>
    <div class="actions">
      <button id="checkout" class="btn">Proceed to Pay</button>
      <button id="test" class="btn ghost">Start Test (No Payment)</button>
    </div>
    <div class="note">Demo: Use Test to bypass payment during testing.</div>
  </div>
  <script>
    function uuid(){var s=[],hex='0123456789abcdef';for(var i=0;i<36;i++){s[i]=hex.substr(Math.floor(Math.random()*16),1)}s[14]='4';s[19]=hex.substr((parseInt(s[19],16)&0x3)|0x8,1);s[8]='-';s[13]='-';s[18]='-';s[23]='-';return s.join('')}
    function setCookie(name,value,days){var d=new Date();d.setTime(d.getTime()+days*24*60*60*1000);document.cookie=name+'='+encodeURIComponent(value)+';expires='+d.toUTCString()+';path=/'}
    async function createOrderAndRedirect(email){
      try{
        var resp=await fetch('/api/orders/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
        var data=await resp.json();
        if(data&&data.success&&data.checkoutUrl){
          localStorage.setItem('nc_order_id',data.orderId);
          setCookie('nc_order_id',data.orderId,365);
          window.location.href=data.checkoutUrl;
          return;
        }
      }catch(e){}
      var orderId=uuid();
      localStorage.setItem('nc_order_id',orderId);
      localStorage.setItem('nc_email',email);
      setCookie('nc_order_id',orderId,365);
      setCookie('nc_email',email,365);
      localStorage.removeItem('nc_test_mode');
      window.location.href='input.html?order_id='+orderId;
    }
    document.getElementById('checkout').addEventListener('click',function(){var email=document.getElementById('email').value.trim();if(!email){alert('Please enter email');return}createOrderAndRedirect(email)})
    document.getElementById('test').addEventListener('click',function(){var email=document.getElementById('email').value.trim()||'tester@example.com';var orderId=uuid();localStorage.setItem('nc_order_id',orderId);localStorage.setItem('nc_email',email);setCookie('nc_order_id',orderId,365);setCookie('nc_email',email,365);localStorage.setItem('nc_test_mode','1');window.location.href='input.html?order_id='+orderId+'&test=1'})
  </script>
</body>
</html>
