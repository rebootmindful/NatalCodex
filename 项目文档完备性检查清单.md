# 项目文档完备性检查清单

# NatalCodex 项目文档完备性检查清单

**检查时间**: 2025年11月26日

**项目阶段**: MVP准备阶段

**目标**: 确保AI编程工具(Cursor/Windsurf)能顺利完成项目开发

***

## 📋 现有文档清单

### ✅ 已完成的核心文档(5份)

| 文档名称               | 行数    | 字数    | 完备性评分      | 说明                              |
| ------------------ | ----- | ----- | ---------- | ------------------------------- |
| **1. 产品方案**        | 808   | 6,273 | ⭐️⭐️⭐️⭐️⭐️ | 产品定位、目标市场、USP、文化适配、商业模式         |
| **2. 需求规格说明书**     | 315   | 2,773 | ⭐️⭐️⭐️⭐️⭐️ | IEEE 830标准、系统架构、功能需求、技术方案       |
| **3. 前端开发方案**      | 1,952 | 6,218 | ⭐️⭐️⭐️⭐️⭐️ | 完整的前端实施指南、组件设计、响应式适配            |
| **4. 后端架构与数据库设计**  | 545   | 2,354 | ⭐️⭐️⭐️⭐️⭐️ | Neon Postgres Schema、API设计、支付集成 |
| **5. 中英文双语版本设计方案** | 882   | 4,554 | ⭐️⭐️⭐️⭐️⭐️ | 术语翻译、视觉适配、技术实现、成本分析             |

**总计**: 4,502行,22,172字

***

## 🔴 缺失的关键文档(P0级别 - MVP无法上线)

### 1. ⚠️ Prompt工程策略文档 (最高优先级)

**为什么关键**:

* 这是产品的**灵魂**,决定AI报告的质量
* AI编程工具无法自己写出高质量的"八字+心理学"融合prompt
* 直接影响用户付费转化率($12.90的价值体现)

**应包含内容**:

* **System Prompt设计**:
  ```
  你是"Eastern Echo"(东方回响),一位同时精通《渊海子平》《滴天髓》
  《三命通会》《穷通宝鉴》和荣格MBTI八功能理论的顶尖大师...
  ```
* **输入数据结构**:
  * 如何把四柱八字(年柱、月柱、日柱、时柱)喂给AI
  * 十神配置如何格式化
  * 五行分值、用神忌神如何表达
* **输出格式要求**:
  * JSON结构化输出(便于前端渲染)
  * 必须包含的章节(性格分析、事业建议、感情观、人生阶段等)
  * 字数要求(2000字±200)
* **Few-Shot示例**(至少3个):
  * 示例1:丁火日主,INFJ案例(已有)
  * 示例2:庚金日主,INTJ案例
  * 示例3:癸水日主,INFP案例
* **Quality控制标准**:
  * 禁止使用的词汇(宿命、灾难、凶煞等负面词)
  * 必须使用的风格(启发性、成长心态、心理学导向)
  * 引用古籍的规范(原文+现代翻译)

**预估工作量**: 3-5人日

***

### 2. ⚠️ 八字计算逻辑文档

**为什么关键**:

* 前端方案提到使用`lunar-javascript`库,但没有详细的调用逻辑
* 真太阳时校正算法需要明确
* 十神、神煞、大运的计算规则需要标准化

**应包含内容**:

* **真太阳时校正函数**:
  ```typescript
  function calculateTrueSolarTime(
    birthDate: Date,
    longitude: number,
    latitude: number
  ): Date {
    // 1. 计算经度时差
    const longitudeDiff = (longitude - 120) * 4; // 分钟
    
    // 2. 计算均时差(Equation of Time)
    const eot = calculateEquationOfTime(birthDate);
    
    // 3. 返回校正后时间
    return new Date(birthDate.getTime() + (longitudeDiff + eot) * 60000);
  }
  ```
* **四柱排盘算法**:
  * 年柱:生肖与天干对应
  * 月柱:节气判断
  * 日柱:万年历查询
  * 时柱:日干起时法
* **十神计算规则**:
  ```typescript
  // 日主为丁火,年干为己土
  // 丁→己: 火生土 → 食神(我生者)
  const getTenGod = (dayMaster: Stem, targetStem: Stem): TenGod => {
    const relation = getStemRelation(dayMaster, targetStem);
    // ... 十神映射逻辑
  }
  ```
* **神煞计算**:
  * 天乙贵人、文昌贵人、羊刃、空亡等查表逻辑
* **大运起运时间**:
  * 阳男阴女顺行,阴男阳女逆行
  * 起运岁数计算公式

**预估工作量**: 2-3人日

***

### 3. ⚠️ 支付流程详细设计文档

**为什么关键**:

* 后端方案提到Creem.io集成,但缺少完整流程图
* Webhook处理逻辑需要明确的状态机
* 错误处理和重试机制未定义

**应包含内容**:

* **完整支付流程图**(从点击付费到报告解锁):
  ```
  用户点击"Unlock Full Report" 
    → 前端调用 POST /api/orders/create
    → 后端创建订单(pending)
    → 返回Creem.io支付链接
    → 用户跳转到Creem.io
    → 用户完成支付
    → Creem.io调用Webhook (POST /api/webhook/creem)
    → 后端验证签名
    → 更新订单状态(pending→paid)
    → 前端轮询订单状态
    → 调用 POST /api/reports/generate
    → 显示完整报告
  ```
* **状态机定义**:
  ```
  pending → paid → report_generated → delivered
  pending → failed
  pending → cancelled
  paid → refunded
  ```
* **Webhook安全验证**:
  ```typescript
  const signature = request.headers['Creem-Signature'];
  const expectedSignature = crypto
    .createHmac('sha256', process.env.CREEM_WEBHOOK_SECRET)
    .update(rawBody)
    .digest('hex');
  if (signature !== `sha256=${expectedSignature}`) {
    throw new Error('Invalid signature');
  }
  ```
* **错误处理策略**:
  * 支付超时(15分钟)
  * 网络中断重试(3次指数退避)
  * 重复回调幂等性处理
* **退款流程**(如需要)

**预估工作量**: 1-2人日

***

## 🟡 重要但非阻塞的文档(P1级别)

### 4. 环境变量配置清单

**应包含内容**:

```shellscript
# .env.example
# ============================================
# 数据库配置
# ============================================
DATABASE_URL="postgresql://user:pass@xxx.neon.tech/natalcodex?sslmode=require"

# ============================================
# Google Vertex AI
# ============================================
GOOGLE_PROJECT_ID="your-gcp-project-id"
GOOGLE_APPLICATION_CREDENTIALS="./service-account-key.json"
VERTEX_AI_LOCATION="us-central1"
VERTEX_AI_MODEL="gemini-1.5-pro"

# ============================================
# Creem.io支付网关
# ============================================
NEXT_PUBLIC_CREEM_PRODUCT_ID="prod_soul_report_12_90"
CREEM_API_KEY="your-creem-api-key"
CREEM_WEBHOOK_SECRET="your-webhook-secret"
NEXT_PUBLIC_CREEM_PUBLISHABLE_KEY="pk_xxx"

# ============================================
# 应用配置
# ============================================
NEXT_PUBLIC_BASE_URL="https://natalcodex.com"
NEXT_PUBLIC_APP_ENV="production" # development | staging | production

# ============================================
# 可选:邮件服务(Phase 2)
# ============================================
# RESEND_API_KEY="re_xxx"
# FROM_EMAIL="noreply@natalcodex.com"

# ============================================
# 可选:分析工具(Phase 2)
# ============================================
# VERCEL_ANALYTICS_ID="xxx"
# GOOGLE_ANALYTICS_ID="G-xxx"
```

**说明文档**:

* 每个变量的获取方式
* 必填 vs 可选
* 开发环境 vs 生产环境的区别

**预估工作量**: 0.5人日

***

### 5. API接口文档(OpenAPI规范)

**为什么重要**:

* 前后端协作的契约
* AI工具可直接生成类型定义和调用代码

**应包含内容**:

```yaml
openapi: 3.0.0
info:
  title: NatalCodex API
  version: 1.0.0
paths:
  /api/orders/create:
    post:
      summary: 创建订单
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                birthData:
                  type: object
                  properties:
                    year: { type: integer }
                    month: { type: integer }
                    day: { type: integer }
                    hour: { type: integer }
                baziResult:
                  type: object
                  # ... 详细schema
      responses:
        200:
          description: 订单创建成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  orderId: { type: string }
                  checkoutUrl: { type: string }
```

**预估工作量**: 1-2人日

***

### 6. 测试用例文档

**应包含内容**:

* **八字计算测试**:
  * 输入:1999.8.8 14:30 上海
  * 期望输出:己卯 壬申 丁巳 丁未
* **MBTI推导测试**:
  * 输入:丁火日主 + 正印 + 食神 + 正官
  * 期望输出:INFJ
* **支付流程端到端测试**:
  * 模拟Webhook回调
  * 验证订单状态更新
* **双语翻译测试**:
  * 食神 → The Artist
  * 伤官生财格 → Rebel-to-Explorer Pattern

**预估工作量**: 1人日

***

## 🟢 优化类文档(P2级别 - 可后续补充)

### 7. SEO优化方案

**内容**:

* Meta标签配置(Title, Description, OG Image)
* 结构化数据(Schema.org)
* Sitemap生成
* 多语言hreflang标签

**预估工作量**: 1人日

***

### 8. 部署与运维文档

**内容**:

* Vercel部署步骤
* Neon数据库初始化脚本
* CI/CD配置
* 监控与日志(Sentry, Vercel Analytics)
* 备份策略

**预估工作量**: 1人日

***

### 9. 用户手册(FAQ)

**内容**:

* 如何使用产品?
* 为什么我的MBTI和传统测试不一样?
* 八字是什么?
* 数据隐私说明

**预估工作量**: 0.5人日

***

## 📊 优先级矩阵

| 文档             | 优先级 | 阻塞MVP? | 工作量(人日) | 建议完成时间  |
| -------------- | --- | ------ | ------- | ------- |
| **Prompt工程策略** | P0  | ✅ 是    | 3-5     | 本周      |
| **八字计算逻辑**     | P0  | ✅ 是    | 2-3     | 本周      |
| **支付流程设计**     | P0  | ✅ 是    | 1-2     | 本周      |
| 环境变量清单         | P1  | ❌ 否    | 0.5     | 下周      |
| API接口文档        | P1  | ❌ 否    | 1-2     | 下周      |
| 测试用例           | P1  | ❌ 否    | 1       | 下周      |
| SEO方案          | P2  | ❌ 否    | 1       | Phase 2 |
| 部署运维           | P2  | ❌ 否    | 1       | Phase 2 |
| 用户手册           | P2  | ❌ 否    | 0.5     | Phase 2 |

***

## 🎯 行动建议

### 本周必须完成(P0文档)

1. **Prompt工程策略文档** (3-5人日)
   * 立即创建
   * 需要专业命理+心理学知识的人参与
   * 这是产品核心竞争力
2. **八字计算逻辑文档** (2-3人日)
   * 基于`lunar-javascript`库封装
   * 提供完整的代码示例
   * 包含测试用例
3. **支付流程详细设计** (1-2人日)
   * 绘制完整流程图
   * 定义状态机
   * Webhook处理逻辑

**总计**: 6-10人日(约1-2周,1人全职)

### 下周补充(P1文档)

* 环境变量配置清单
* API接口文档(OpenAPI规范)
* 测试用例文档

**总计**: 2.5-3.5人日

***

## ✅ 文档完备性评估

### 当前状态

* **已完成**: 5份核心文档(22,172字)
* **缺失P0**: 3份关键文档
* **缺失P1**: 3份重要文档
* **缺失P2**: 3份优化文档

### 完备性评分

* **产品层面**: ⭐️⭐️⭐️⭐️⭐️ (100%)
* **技术架构**: ⭐️⭐️⭐️⭐️⭐️ (100%)
* **实施细节**: ⭐️⭐️⭐️☆☆ (60%)
* **业务逻辑**: ⭐️⭐️☆☆☆ (40%)

**总体评分**: ⭐️⭐️⭐️⭐️☆ (75%)

### 评估结论

**当前状态**: 框架完整,细节待补

**建议**: 优先补充P0级别的3份文档,确保MVP能顺利开发

***

## 🚀 给AI编程工具的建议

### 可以开始的工作(基于现有文档)

✅ **前端UI开发**:

* Landing Page
* Input Form(出生信息表单)
* Result Page基础布局
* 响应式适配

✅ **数据库Schema实现**:

* Neon Postgres创建
* Drizzle ORM配置
* 表结构创建

✅ **基础API路由**:

* `/api/orders/create` (预创建订单)
* `/api/reports/:id` (查询报告)

### 暂时无法开始的工作(缺少文档)

❌ **八字计算功能**:

* 需要详细的计算逻辑文档
* 十神、神煞规则未明确

❌ **AI报告生成**:

* 需要Prompt工程策略文档
* 输入输出格式未定义

❌ **支付完整流程**:

* 需要状态机和错误处理逻辑
* Webhook处理细节缺失

***

## 📝 文档模板建议

为了加快文档创建速度,建议使用以下模板:

### Prompt工程策略文档模板

```markdown
# NatalCodex Prompt工程策略

## 1. System Prompt设计
### 1.1 角色定义
### 1.2 知识范围
### 1.3 输出规范

## 2. 输入数据结构
### 2.1 八字数据格式
### 2.2 MBTI推导结果
### 2.3 用神忌神

## 3. 输出格式要求
### 3.1 JSON结构
### 3.2 必须章节
### 3.3 字数要求

## 4. Few-Shot示例
### 4.1 示例1:丁火INFJ
### 4.2 示例2:庚金INTJ
### 4.3 示例3:癸水INFP

## 5. Quality控制
### 5.1 禁止词汇
### 5.2 必须风格
### 5.3 引用规范
```

***

## 🎯 下一步行动

**立即行动**:

1. 创建"Prompt工程策略文档"(最高优先级)
2. 创建"八字计算逻辑文档"
3. 创建"支付流程详细设计文档"

**预期完成时间**: 1-2周(1人全职)

**完成后**: 可以向AI编程工具提交完整的项目文档,开始全面开发

***

**注**: 本清单将持续更新,随着项目进展补充新的文档需求。

