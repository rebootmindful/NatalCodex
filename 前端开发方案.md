# å‰ç«¯å¼€å‘æ–¹æ¡ˆ

# NatalCodex å‰ç«¯å¼€å‘æ–¹æ¡ˆ

**é¢å‘AIç¼–ç¨‹çš„å®Œæ•´å®æ–½æŒ‡å—**

ç‰ˆæœ¬: 1.0 | æŠ€æœ¯æ ˆ: Next.js 14+ TypeScript Tailwind CSS

***

## ç›®å½•

1. [é¡¹ç›®åˆå§‹åŒ–](#1-é¡¹ç›®åˆå§‹åŒ–)
2. [æ ¸å¿ƒç±»å‹å®šä¹‰](#2-æ ¸å¿ƒç±»å‹å®šä¹‰)
3. [å·¥å…·å‡½æ•°åº“](#3-å·¥å…·å‡½æ•°åº“)
4. [çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ](#4-çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ)
5. [ç»„ä»¶è®¾è®¡](#5-ç»„ä»¶è®¾è®¡)
6. [é¡µé¢è·¯ç”±](#6-é¡µé¢è·¯ç”±)
7. [APIé›†æˆ](#7-apié›†æˆ)
8. [æ ·å¼ç³»ç»Ÿ](#8-æ ·å¼ç³»ç»Ÿ)
9. [éƒ¨ç½²é…ç½®](#9-éƒ¨ç½²é…ç½®)

***

## 1. é¡¹ç›®åˆå§‹åŒ–

### 1.1 åˆ›å»ºé¡¹ç›®

```shellscript
npx create-next-app@latest natalcodex --typescript --tailwind --app --use-npm
cd natalcodex
```

### 1.2 å®‰è£…ä¾èµ–

```shellscript
# æ ¸å¿ƒä¾èµ–
npm install lunar-javascript
npm install zustand
npm install framer-motion
npm install @radix-ui/react-dialog @radix-ui/react-select
npm install html2canvas
npm install axios

# å¼€å‘ä¾èµ–
npm install -D @types/node
```

### 1.3 package.json

```json
{
  "name": "natalcodex",
  "version": "1.0.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "typescript": "^5.4.0",
    "tailwindcss": "^3.4.0",
    "framer-motion": "^11.0.0",
    "lunar-javascript": "^1.6.12",
    "zustand": "^4.5.0",
    "@radix-ui/react-dialog": "^1.0.5",
    "@radix-ui/react-select": "^2.0.0",
    "html2canvas": "^1.4.1",
    "axios": "^1.6.0"
  },
  "devDependencies": {
    "@types/node": "^20.11.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0"
  }
}
```

### 1.4 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

### 1.5 tailwind.config.ts (Cyber-Zenä¸»é¢˜)

```typescript
import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        // Cyber-Zené…è‰²æ–¹æ¡ˆ
        'cyber': {
          'dark': '#0a0e27',      // æ·±ç©ºç°
          'accent': '#00ff9d',    // è§å…‰ç»¿
          'purple': '#9d4edd',    // æ˜Ÿç©ºç´«
          'sage': '#d4d4d8',      // ç¦…æ„ç°
        },
        'zen': {
          'vermilion': '#e63946',  // æœ±ç ‚çº¢
          'stone': '#a8a29e',      // çŸ³ç°
          'bamboo': '#52b788',     // ç«¹ç»¿
        },
        // äº”è¡Œé…è‰²
        'element': {
          'wood': '#52b788',    // æœ¨
          'fire': '#e63946',    // ç«
          'earth': '#ca6702',   // åœŸ
          'metal': '#d4d4d8',   // é‡‘
          'water': '#219ebc',   // æ°´
        }
      },
      fontFamily: {
        'sans': ['Inter', 'system-ui', 'sans-serif'],
        'serif': ['Playfair Display', 'serif'],
        'mono': ['JetBrains Mono', 'monospace'],
      },
      animation: {
        'spin-slow': 'spin 3s linear infinite',
        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
        'float': 'float 3s ease-in-out infinite',
      },
      keyframes: {
        'pulse-glow': {
          '0%, 100%': { opacity: '1', boxShadow: '0 0 20px rgba(0, 255, 157, 0.5)' },
          '50%': { opacity: '0.8', boxShadow: '0 0 40px rgba(0, 255, 157, 0.8)' },
        },
        'float': {
          '0%, 100%': { transform: 'translateY(0px)' },
          '50%': { transform: 'translateY(-10px)' },
        },
      },
    },
  },
  plugins: [],
}
export default config
```

### 1.6 é¡¹ç›®ç›®å½•ç»“æ„

```
natalcodex/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx              # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx                # Landing Page
â”‚   â”œâ”€â”€ input/
â”‚   â”‚   â””â”€â”€ page.tsx            # å‡ºç”Ÿä¿¡æ¯è¾“å…¥é¡µ
â”‚   â”œâ”€â”€ result/
â”‚   â”‚   â””â”€â”€ page.tsx            # ç»“æœå±•ç¤ºé¡µ
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ generate-report/
â”‚   â”‚   â”‚   â””â”€â”€ route.ts        # AIæŠ¥å‘Šç”ŸæˆAPI
â”‚   â”‚   â””â”€â”€ webhook/
â”‚   â”‚       â””â”€â”€ creem/
â”‚   â”‚           â””â”€â”€ route.ts    # æ”¯ä»˜å›è°ƒ
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ BirthInputForm.tsx      # å‡ºç”Ÿä¿¡æ¯è¡¨å•
â”‚   â”œâ”€â”€ LoadingAnimation.tsx    # è®¡ç®—LoadingåŠ¨ç”»
â”‚   â”œâ”€â”€ SoulprintCard.tsx       # çµé­‚æŒ‡çº¹å¡ç»„ä»¶
â”‚   â”œâ”€â”€ MBTIDisplay.tsx         # MBTIç»“æœå±•ç¤º
â”‚   â”œâ”€â”€ ElementRadar.tsx        # äº”è¡Œé›·è¾¾å›¾
â”‚   â”œâ”€â”€ PaymentButton.tsx       # æ”¯ä»˜æŒ‰é’®
â”‚   â””â”€â”€ ReportRenderer.tsx      # AIæŠ¥å‘Šæ¸²æŸ“å™¨
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ bazi-calculator.ts      # å…«å­—æ’ç›˜é€»è¾‘
â”‚   â”œâ”€â”€ mbti-mapper.ts          # MBTIæ˜ å°„ç®—æ³•
â”‚   â”œâ”€â”€ element-translator.ts   # æœ¯è¯­ç¿»è¯‘
â”‚   â”œâ”€â”€ card-generator.ts       # å¡ç‰‡å›¾ç‰‡ç”Ÿæˆ
â”‚   â”œâ”€â”€ api-client.ts           # APIè°ƒç”¨å°è£…
â”‚   â””â”€â”€ storage.ts              # LocalStorageå·¥å…·
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ bazi.ts                 # å…«å­—ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ mbti.ts                 # MBTIç›¸å…³ç±»å‹
â”‚   â””â”€â”€ api.ts                  # APIæ¥å£ç±»å‹
â”œâ”€â”€ store/
â”‚   â””â”€â”€ user-data.ts            # zustand store
â”œâ”€â”€ public/
â”‚   â””â”€â”€ assets/                 # é™æ€èµ„æº
â”œâ”€â”€ .env.local                  # ç¯å¢ƒå˜é‡
â””â”€â”€ next.config.js
```

***

## 2. æ ¸å¿ƒç±»å‹å®šä¹‰

### types/bazi.ts

```typescript
/**
 * å‡ºç”Ÿä¿¡æ¯
 */
export interface BirthData {
  year: number;
  month: number;
  day: number;
  hour?: number;          // å¯é€‰,ç”¨äºæ’æ—¶æŸ±
  location?: string;      // å¯é€‰,ç”¨äºçœŸå¤ªé˜³æ—¶æ ¡æ­£
  gender?: 'male' | 'female';
}

/**
 * å¤©å¹²åœ°æ”¯
 */
export type HeavenlyStem = 'ç”²' | 'ä¹™' | 'ä¸™' | 'ä¸' | 'æˆŠ' | 'å·±' | 'åºš' | 'è¾›' | 'å£¬' | 'ç™¸';
export type EarthlyBranch = 'å­' | 'ä¸‘' | 'å¯…' | 'å¯' | 'è¾°' | 'å·³' | 'åˆ' | 'æœª' | 'ç”³' | 'é…‰' | 'æˆŒ' | 'äº¥';

/**
 * äº”è¡Œ
 */
export type Element = 'Wood' | 'Fire' | 'Earth' | 'Metal' | 'Water';

/**
 * å››æŸ±(å¹´æœˆæ—¥æ—¶)
 */
export interface FourPillars {
  year: string;    // å¹´æŸ±,å¦‚"ç”²å­"
  month: string;   // æœˆæŸ±
  day: string;     // æ—¥æŸ±
  hour?: string;   // æ—¶æŸ±(å¯é€‰)
}

/**
 * å…«å­—æ’ç›˜ç»“æœ
 */
export interface BaZiResult {
  pillars: FourPillars;
  dayMaster: HeavenlyStem;              // æ—¥ä¸»(æ—¥å¹²)
  dayMasterElement: Element;             // æ—¥ä¸»äº”è¡Œ
  elementBalance: Record<Element, number>; // äº”è¡Œèƒ½é‡åˆ†å¸ƒ
  dominantElement: Element;              // æœ€å¼ºå…ƒç´ 
  energyScore: {
    wood: number;
    fire: number;
    earth: number;
    metal: number;
    water: number;
  };
}
```

### types/mbti.ts

```typescript
/**
 * MBTIå››ä¸ªç»´åº¦
 */
export type MBTIDimension = {
  EI: 'E' | 'I';  // å¤–å‘/å†…å‘
  SN: 'S' | 'N';  // å®æ„Ÿ/ç›´è§‰
  TF: 'T' | 'F';  // æ€è€ƒ/æƒ…æ„Ÿ
  JP: 'J' | 'P';  // åˆ¤æ–­/æ„ŸçŸ¥
};

/**
 * MBTIç±»å‹(16ç§)
 */
export type MBTIType = 'INTJ' | 'INTP' | 'ENTJ' | 'ENTP' |
                       'INFJ' | 'INFP' | 'ENFJ' | 'ENFP' |
                       'ISTJ' | 'ISFJ' | 'ESTJ' | 'ESFJ' |
                       'ISTP' | 'ISFP' | 'ESTP' | 'ESFP';

/**
 * MBTIç»“æœ
 */
export interface MBTIResult {
  type: MBTIType;
  dimensions: MBTIDimension;
  archetype: string;        // åŸå‹åç§°,å¦‚"The Architect"
  coreTraits: string[];     // æ ¸å¿ƒç‰¹è´¨
  strengthScore: number;    // åŒ¹é…å¼ºåº¦(0-100)
}

/**
 * MBTIåŸå‹å®šä¹‰
 */
export interface MBTIArchetype {
  type: MBTIType;
  name: string;             // è‹±æ–‡åç§°
  nameCN: string;           // ä¸­æ–‡åç§°
  symbol: string;           // ç¬¦å·/emoji
  powerQuote: string;       // Power Quote
  description: string;      // ç®€çŸ­æè¿°
}
```

### types/card.ts

```typescript
import { BaZiResult } from './bazi';
import { MBTIResult } from './mbti';

/**
 * Soulprint Cardæ•°æ®
 */
export interface SoulprintCardData {
  mbti: MBTIResult;
  bazi: BaZiResult;
  dayMasterImagery: string;     // æ—¥ä¸»æ„è±¡,å¦‚"The Ocean"
  powerQuote: string;
  generatedAt: string;          // ISOæ—¶é—´æˆ³
  isPremium: boolean;           // æ˜¯å¦ä»˜è´¹ç‰ˆ
}

/**
 * å¡ç‰‡æ ·å¼é…ç½®
 */
export interface CardStyle {
  width: number;
  height: number;
  backgroundColor: string;
  textColor: string;
  accentColor: string;
  hasWatermark: boolean;
}
```

### types/api.ts

```typescript
import { BaZiResult } from './bazi';
import { MBTIResult } from './mbti';

/**
 * ç”ŸæˆæŠ¥å‘ŠAPIè¯·æ±‚
 */
export interface GenerateReportRequest {
  birthData: BirthData;
  baziResult: BaZiResult;
  mbtiResult: MBTIResult;
  paymentId?: string;  // ç”¨äºéªŒè¯ä»˜è´¹çŠ¶æ€
}

/**
 * ç”ŸæˆæŠ¥å‘ŠAPIå“åº”
 */
export interface GenerateReportResponse {
  success: boolean;
  data?: {
    reportContent: string;  // Markdownæ ¼å¼
    generatedAt: string;
  };
  error?: string;
}

/**
 * Creem.ioæ”¯ä»˜ä¼šè¯åˆ›å»º
 */
export interface CreemCheckoutRequest {
  productId: string;
  email?: string;
  currency: string;
  successUrl: string;
  cancelUrl: string;
}

export interface CreemCheckoutResponse {
  checkoutUrl: string;
  sessionId: string;
}
```

***

## 3. å·¥å…·å‡½æ•°åº“

### lib/bazi-calculator.ts

```typescript
import { Solar, Lunar } from 'lunar-javascript';
import { BirthData, BaZiResult, FourPillars, Element, HeavenlyStem } from '@/types/bazi';

/**
 * å¤©å¹²äº”è¡Œæ˜ å°„
 */
const STEM_ELEMENT_MAP: Record<HeavenlyStem, Element> = {
  'ç”²': 'Wood', 'ä¹™': 'Wood',
  'ä¸™': 'Fire', 'ä¸': 'Fire',
  'æˆŠ': 'Earth', 'å·±': 'Earth',
  'åºš': 'Metal', 'è¾›': 'Metal',
  'å£¬': 'Water', 'ç™¸': 'Water',
};

/**
 * è®¡ç®—å››æŸ±å…«å­—
 */
export function calculateFourPillars(birthData: BirthData): FourPillars {
  const { year, month, day, hour = 12 } = birthData;
  
  // ä½¿ç”¨lunar-javascriptåº“
  const solar = Solar.fromYmdHms(year, month, day, hour, 0, 0);
  const lunar = solar.getLunar();
  
  return {
    year: lunar.getYearInGanZhi(),
    month: lunar.getMonthInGanZhi(),
    day: lunar.getDayInGanZhi(),
    hour: lunar.getTimeInGanZhi(),
  };
}

/**
 * æå–æ—¥ä¸»(æ—¥æŸ±å¤©å¹²)
 */
export function extractDayMaster(dayPillar: string): HeavenlyStem {
  return dayPillar.charAt(0) as HeavenlyStem;
}

/**
 * è®¡ç®—äº”è¡Œèƒ½é‡åˆ†å¸ƒ
 */
export function calculateElementBalance(pillars: FourPillars): Record<Element, number> {
  const balance: Record<Element, number> = {
    Wood: 0,
    Fire: 0,
    Earth: 0,
    Metal: 0,
    Water: 0,
  };
  
  // ç»Ÿè®¡å››æŸ±ä¸­çš„å¤©å¹²äº”è¡Œ
  const allStems = [
    pillars.year.charAt(0),
    pillars.month.charAt(0),
    pillars.day.charAt(0),
    pillars.hour?.charAt(0) || '',
  ].filter(s => s) as HeavenlyStem[];
  
  allStems.forEach(stem => {
    const element = STEM_ELEMENT_MAP[stem];
    balance[element] += 1;
  });
  
  return balance;
}

/**
 * å®Œæ•´çš„å…«å­—æ’ç›˜
 */
export function performBaZiAnalysis(birthData: BirthData): BaZiResult {
  const pillars = calculateFourPillars(birthData);
  const dayMaster = extractDayMaster(pillars.day);
  const dayMasterElement = STEM_ELEMENT_MAP[dayMaster];
  const elementBalance = calculateElementBalance(pillars);
  
  // æ‰¾å‡ºæœ€å¼ºå…ƒç´ 
  const dominantElement = (Object.keys(elementBalance) as Element[]).reduce((a, b) =>
    elementBalance[a] > elementBalance[b] ? a : b
  );
  
  // è½¬æ¢ä¸º0-100çš„èƒ½é‡åˆ†æ•°
  const total = Object.values(elementBalance).reduce((a, b) => a + b, 0);
  const energyScore = {
    wood: Math.round((elementBalance.Wood / total) * 100),
    fire: Math.round((elementBalance.Fire / total) * 100),
    earth: Math.round((elementBalance.Earth / total) * 100),
    metal: Math.round((elementBalance.Metal / total) * 100),
    water: Math.round((elementBalance.Water / total) * 100),
  };
  
  return {
    pillars,
    dayMaster,
    dayMasterElement,
    elementBalance,
    dominantElement,
    energyScore,
  };
}
```

### lib/mbti-mapper.ts

```typescript
import { BaZiResult } from '@/types/bazi';
import { MBTIResult, MBTIType, MBTIDimension } from '@/types/mbti';
import { MBTI_ARCHETYPES } from '@/lib/mbti-archetypes';

/**
 * å…«å­—æ˜ å°„MBTIçš„æ ¸å¿ƒç®—æ³•
 */
export function mapBaZiToMBTI(baziResult: BaZiResult): MBTIResult {
  const dimensions: MBTIDimension = {
    EI: determineEI(baziResult),
    SN: determineSN(baziResult),
    TF: determineTF(baziResult),
    JP: determineJP(baziResult),
  };
  
  const type = `${dimensions.EI}${dimensions.SN}${dimensions.TF}${dimensions.JP}` as MBTIType;
  const archetype = MBTI_ARCHETYPES[type];
  
  return {
    type,
    dimensions,
    archetype: archetype.name,
    coreTraits: generateCoreTraits(type),
    strengthScore: 75, // å¯æ ¹æ®äº”è¡Œå¹³è¡¡åº¦åŠ¨æ€è®¡ç®—
  };
}

/**
 * E/Iç»´åº¦åˆ¤æ–­(å¤–å‘/å†…å‘)
 * è§„åˆ™:é˜³å¹²å€¾å‘E,é˜´å¹²å€¾å‘I
 */
function determineEI(bazi: BaZiResult): 'E' | 'I' {
  const yangStems = ['ç”²', 'ä¸™', 'æˆŠ', 'åºš', 'å£¬'];
  const isYang = yangStems.includes(bazi.dayMaster);
  return isYang ? 'E' : 'I';
}

/**
 * S/Nç»´åº¦åˆ¤æ–­(å®æ„Ÿ/ç›´è§‰)
 * è§„åˆ™:åœŸé‡‘é‡â†’S,æ°´ç«é‡â†’N
 */
function determineSN(bazi: BaZiResult): 'S' | 'N' {
  const earthMetal = bazi.energyScore.earth + bazi.energyScore.metal;
  const waterFire = bazi.energyScore.water + bazi.energyScore.fire;
  return earthMetal > waterFire ? 'S' : 'N';
}

/**
 * T/Fç»´åº¦åˆ¤æ–­(æ€è€ƒ/æƒ…æ„Ÿ)
 * è§„åˆ™:é‡‘æ°´é‡â†’T,æœ¨ç«é‡â†’F
 */
function determineTF(bazi: BaZiResult): 'T' | 'F' {
  const metalWater = bazi.energyScore.metal + bazi.energyScore.water;
  const woodFire = bazi.energyScore.wood + bazi.energyScore.fire;
  return metalWater > woodFire ? 'T' : 'F';
}

/**
 * J/Pç»´åº¦åˆ¤æ–­(åˆ¤æ–­/æ„ŸçŸ¥)
 * è§„åˆ™:åœŸå¼ºâ†’J,æœ¨å¼ºâ†’P
 */
function determineJP(bazi: BaZiResult): 'J' | 'P' {
  return bazi.energyScore.earth > bazi.energyScore.wood ? 'J' : 'P';
}

/**
 * ç”Ÿæˆæ ¸å¿ƒç‰¹è´¨æè¿°
 */
function generateCoreTraits(type: MBTIType): string[] {
  const traits: Record<MBTIType, string[]> = {
    'INTJ': ['Strategic', 'Independent', 'Analytical'],
    'INFP': ['Idealistic', 'Empathetic', 'Creative'],
    // ... å…¶ä»–15ç§ç±»å‹
  };
  return traits[type] || [];
}
```

### lib/element-translator.ts

```typescript
import { HeavenlyStem, Element } from '@/types/bazi';

/**
 * å¤©å¹²è‹±æ–‡ç¿»è¯‘
 */
export const STEM_TRANSLATION: Record<HeavenlyStem, { en: string; symbol: string; archetype: string }> = {
  'ç”²': { en: 'Yang Wood', symbol: 'ğŸŒ²', archetype: 'The Pioneer' },
  'ä¹™': { en: 'Yin Wood', symbol: 'ğŸŒ¿', archetype: 'The Diplomat' },
  'ä¸™': { en: 'Yang Fire', symbol: 'ğŸ”¥', archetype: 'The Catalyst' },
  'ä¸': { en: 'Yin Fire', symbol: 'ğŸ•¯ï¸', archetype: 'The Illuminator' },
  'æˆŠ': { en: 'Yang Earth', symbol: 'ğŸ”ï¸', archetype: 'The Mountain' },
  'å·±': { en: 'Yin Earth', symbol: 'ğŸŒ¾', archetype: 'The Nurturer' },
  'åºš': { en: 'Yang Metal', symbol: 'âš”ï¸', archetype: 'The Warrior' },
  'è¾›': { en: 'Yin Metal', symbol: 'ğŸ’', archetype: 'The Jewel' },
  'å£¬': { en: 'Yang Water', symbol: 'ğŸŒŠ', archetype: 'The Ocean' },
  'ç™¸': { en: 'Yin Water', symbol: 'â˜”', archetype: 'The Rain' },
};

/**
 * äº”è¡Œè‹±æ–‡æè¿°
 */
export const ELEMENT_DESCRIPTION: Record<Element, string> = {
  Wood: 'Growth, creativity, and flexibility',
  Fire: 'Passion, transformation, and enthusiasm',
  Earth: 'Stability, nourishment, and grounding',
  Metal: 'Precision, discipline, and clarity',
  Water: 'Flow, intuition, and adaptability',
};

/**
 * è·å–æ—¥ä¸»æ„è±¡æè¿°
 */
export function getDayMasterImagery(dayMaster: HeavenlyStem): string {
  return STEM_TRANSLATION[dayMaster].archetype;
}
```

***

## 4. çŠ¶æ€ç®¡ç†æ–¹æ¡ˆ

### store/user-data.ts (zustand)

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import { BirthData, BaZiResult } from '@/types/bazi';
import { MBTIResult } from '@/types/mbti';

interface UserDataState {
  // æ•°æ®
  birthData: BirthData | null;
  baziResult: BaZiResult | null;
  mbtiResult: MBTIResult | null;
  isPaid: boolean;
  reportContent: string | null;
  
  // æ“ä½œ
  setBirthData: (data: BirthData) => void;
  setBaziResult: (result: BaZiResult) => void;
  setMbtiResult: (result: MBTIResult) => void;
  setPaidStatus: (status: boolean) => void;
  setReportContent: (content: string) => void;
  reset: () => void;
}

export const useUserDataStore = create<UserDataState>()(persist(
  (set) => ({
    // åˆå§‹çŠ¶æ€
    birthData: null,
    baziResult: null,
    mbtiResult: null,
    isPaid: false,
    reportContent: null,
    
    // Actions
    setBirthData: (data) => set({ birthData: data }),
    setBaziResult: (result) => set({ baziResult: result }),
    setMbtiResult: (result) => set({ mbtiResult: result }),
    setPaidStatus: (status) => set({ isPaid: status }),
    setReportContent: (content) => set({ reportContent: content }),
    reset: () => set({
      birthData: null,
      baziResult: null,
      mbtiResult: null,
      isPaid: false,
      reportContent: null,
    }),
  }),
  {
    name: 'natal-user-data',
    // ä»…æŒä¹…åŒ–å…³é”®æ•°æ®
    partialize: (state) => ({
      birthData: state.birthData,
      isPaid: state.isPaid,
    }),
  }
));
```

***

## 5. ç»„ä»¶è®¾è®¡

### components/BirthInputForm.tsx

```typescript
'use client';
import { useState } from 'react';
import { BirthData } from '@/types/bazi';

interface BirthInputFormProps {
  onSubmit: (data: BirthData) => void;
  isLoading?: boolean;
}

export function BirthInputForm({ onSubmit, isLoading = false }: BirthInputFormProps) {
  const [formData, setFormData] = useState<BirthData>({
    year: new Date().getFullYear() - 25,
    month: 1,
    day: 1,
    hour: 12,
  });
  
  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    // åŸºç¡€æ ¡éªŒ
    if (!validateDate(formData)) {
      alert('Invalid date');
      return;
    }
    onSubmit(formData);
  };
  
  return (
    <form onSubmit={handleSubmit} className="space-y-6 max-w-md mx-auto">
      <div className="text-center mb-8">
        <h2 className="text-3xl font-serif text-cyber-accent">
          Enter Your Birth Codex
        </h2>
        <p className="text-zen-stone mt-2">
          Data stays on your device
        </p>
      </div>
      
      {/* æ—¥æœŸé€‰æ‹©å™¨ */}
      <div className="grid grid-cols-3 gap-4">
        <div>
          <label className="block text-sm mb-2">Year</label>
          <input
            type="number"
            value={formData.year}
            onChange={(e) => setFormData({ ...formData, year: parseInt(e.target.value) })}
            className="w-full px-4 py-2 bg-cyber-dark border border-cyber-sage rounded-lg"
            min={1900}
            max={new Date().getFullYear()}
          />
        </div>
        {/* Month, Dayç±»ä¼¼ */}
      </div>
      
      {/* æ—¶è¾°é€‰æ‹©(å¯é€‰) */}
      <div>
        <label className="block text-sm mb-2">Hour (Optional)</label>
        <input type="number" min={0} max={23} />
      </div>
      
      <button
        type="submit"
        disabled={isLoading}
        className="w-full py-3 bg-gradient-to-r from-cyber-accent to-cyber-purple text-cyber-dark font-bold rounded-lg hover:scale-105 transition-transform"
      >
        {isLoading ? 'Decoding...' : 'Unlock My Soulprint'}
      </button>
    </form>
  );
}

function validateDate(data: BirthData): boolean {
  const date = new Date(data.year, data.month - 1, data.day);
  return !isNaN(date.getTime());
}
```

### components/LoadingAnimation.tsx

```typescript
'use client';
import { motion } from 'framer-motion';

interface LoadingAnimationProps {
  messages?: string[];
}

export function LoadingAnimation({ 
  messages = [
    'Decoding your natal codex...',
    'Analyzing elemental balance...',
    'Mapping archetypes...',
  ]
}: LoadingAnimationProps) {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-cyber-dark">
      {/* æ—‹è½¬çš„å…«å¦å›¾æ ‡ */}
      <motion.div
        animate={{ rotate: 360 }}
        transition={{ duration: 3, repeat: Infinity, ease: 'linear' }}
        className="w-32 h-32 mb-8"
      >
        <svg viewBox="0 0 100 100" className="w-full h-full">
          <circle
            cx="50"
            cy="50"
            r="40"
            fill="none"
            stroke="url(#gradient)"
            strokeWidth="2"
            strokeDasharray="10 5"
          />
          <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#00ff9d" />
              <stop offset="100%" stopColor="#9d4edd" />
            </linearGradient>
          </defs>
        </svg>
      </motion.div>
      
      {/* æ¶ˆæ¯è½®æ’­ */}
      <div className="text-center">
        {messages.map((msg, idx) => (
          <motion.p
            key={idx}
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: idx * 1.5, duration: 0.5 }}
            className="text-cyber-accent font-mono"
          >
            {msg}
          </motion.p>
        ))}
      </div>
    </div>
  );
}
```

### components/SoulprintCard.tsx

```typescript
'use client';
import { SoulprintCardData } from '@/types/card';
import { ElementRadar } from './ElementRadar';

interface SoulprintCardProps {
  data: SoulprintCardData;
  hasWatermark?: boolean;
}

export function SoulprintCard({ data, hasWatermark = true }: SoulprintCardProps) {
  const { mbti, bazi, dayMasterImagery, powerQuote } = data;
  
  return (
    <div className="relative w-full max-w-lg aspect-[3/4] bg-gradient-to-br from-cyber-dark via-cyber-purple/20 to-cyber-dark rounded-2xl overflow-hidden">
      {/* èƒŒæ™¯çº¹ç† */}
      <div className="absolute inset-0 opacity-10">
        <div className="w-full h-full" style={{ backgroundImage: 'url(/fingerprint-texture.svg)' }} />
      </div>
      
      {/* ä¸»è¦å†…å®¹åŒº */}
      <div className="relative z-10 p-8 flex flex-col justify-between h-full">
        {/* é¡¶éƒ¨:MBTIç±»å‹ */}
        <div className="text-center">
          <h2 className="text-6xl font-bold text-cyber-accent tracking-wider">
            {mbti.type}
          </h2>
          <p className="text-xl text-zen-stone mt-2">{mbti.archetype}</p>
        </div>
        
        {/* ä¸­éƒ¨:æ—¥ä¸»æ„è±¡ */}
        <div className="text-center">
          <p className="text-2xl font-serif text-white">{dayMasterImagery}</p>
          <p className="text-sm text-zen-stone mt-4 italic">"{powerQuote}"</p>
        </div>
        
        {/* åº•éƒ¨:äº”è¡Œé›·è¾¾å›¾ */}
        <div className="flex justify-center">
          <ElementRadar energyScore={bazi.energyScore} size={200} />
        </div>
      </div>
      
      {/* æ°´å° */}
      {hasWatermark && (
        <div className="absolute bottom-4 right-4 text-zen-stone/50 text-sm">
          NatalCodex
        </div>
      )}
    </div>
  );
}
```

### components/ElementRadar.tsx (äº”è¡Œé›·è¾¾å›¾)

```typescript
'use client';
import { motion } from 'framer-motion';

interface ElementRadarProps {
  energyScore: {
    wood: number;
    fire: number;
    earth: number;
    metal: number;
    water: number;
  };
  size?: number;
}

export function ElementRadar({ energyScore, size = 200 }: ElementRadarProps) {
  const elements = [
    { name: 'Wood', value: energyScore.wood, color: '#52b788', angle: 0 },
    { name: 'Fire', value: energyScore.fire, color: '#e63946', angle: 72 },
    { name: 'Earth', value: energyScore.earth, color: '#ca6702', angle: 144 },
    { name: 'Metal', value: energyScore.metal, color: '#d4d4d8', angle: 216 },
    { name: 'Water', value: energyScore.water, color: '#219ebc', angle: 288 },
  ];
  
  // ç”Ÿæˆé›·è¾¾å›¾çš„SVGè·¯å¾„
  const generatePath = () => {
    const center = size / 2;
    const maxRadius = (size / 2) * 0.8;
    const points = elements.map((el) => {
      const radius = (el.value / 100) * maxRadius;
      const angleRad = (el.angle * Math.PI) / 180;
      const x = center + radius * Math.cos(angleRad - Math.PI / 2);
      const y = center + radius * Math.sin(angleRad - Math.PI / 2);
      return `${x},${y}`;
    });
    return `M ${points.join(' L ')} Z`;
  };
  
  return (
    <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
      {/* èƒŒæ™¯ç½‘æ ¼ */}
      {[0.2, 0.4, 0.6, 0.8, 1].map((scale) => (
        <polygon
          key={scale}
          points={elements.map((el) => {
            const center = size / 2;
            const radius = (size / 2) * 0.8 * scale;
            const angleRad = (el.angle * Math.PI) / 180;
            const x = center + radius * Math.cos(angleRad - Math.PI / 2);
            const y = center + radius * Math.sin(angleRad - Math.PI / 2);
            return `${x},${y}`;
          }).join(' ')}
          fill="none"
          stroke="rgba(255,255,255,0.1)"
          strokeWidth="1"
        />
      ))}
      
      {/* æ•°æ®åŒºåŸŸ */}
      <motion.path
        d={generatePath()}
        fill="rgba(0, 255, 157, 0.3)"
        stroke="#00ff9d"
        strokeWidth="2"
        initial={{ pathLength: 0 }}
        animate={{ pathLength: 1 }}
        transition={{ duration: 1, ease: 'easeOut' }}
      />
    </svg>
  );
}
```

***

## 6. é¡µé¢è·¯ç”±

### app/page.tsx (Landing Page)

```typescript
import Link from 'next/link';
import { motion } from 'framer-motion';

export default function HomePage() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-cyber-dark to-black">
      {/* Hero Section */}
      <section className="container mx-auto px-4 py-20 text-center">
        <motion.h1 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-6xl md:text-8xl font-bold text-cyber-accent mb-6"
        >
          NatalCodex
        </motion.h1>
        
        <motion.p
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.3 }}
          className="text-2xl md:text-3xl font-serif text-white mb-12"
        >
          Unlock the Source Code of Your Soul
        </motion.p>
        
        <Link
          href="/input"
          className="inline-block px-8 py-4 bg-cyber-accent text-cyber-dark font-bold rounded-lg text-lg hover:scale-110 transition-transform"
        >
          Begin Your Journey
        </Link>
      </section>
      
      {/* Feature Section */}
      <section className="container mx-auto px-4 py-20">
        <div className="grid md:grid-cols-3 gap-8">
          <FeatureCard 
            title="Ancient Wisdom"
            description="Based on 5000-year-old BaZi system"
            icon="ğŸ”®"
          />
          <FeatureCard
            title="Modern Psychology"
            description="Mapped to MBTI personality types"
            icon="ğŸ§ "
          />
          <FeatureCard
            title="AI-Powered"
            description="Deep insights from advanced AI"
            icon="âœ¨"
          />
        </div>
      </section>
    </div>
  );
}

function FeatureCard({ title, description, icon }: { title: string; description: string; icon: string }) {
  return (
    <div className="bg-cyber-dark/50 border border-cyber-sage/30 rounded-xl p-6 hover:border-cyber-accent transition-colors">
      <div className="text-5xl mb-4">{icon}</div>
      <h3 className="text-xl font-bold text-white mb-2">{title}</h3>
      <p className="text-zen-stone">{description}</p>
    </div>
  );
}
```

### app/input/page.tsx

```typescript
'use client';
import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { BirthInputForm } from '@/components/BirthInputForm';
import { LoadingAnimation } from '@/components/LoadingAnimation';
import { useUserDataStore } from '@/store/user-data';
import { performBaZiAnalysis } from '@/lib/bazi-calculator';
import { mapBaZiToMBTI } from '@/lib/mbti-mapper';
import { BirthData } from '@/types/bazi';

export default function InputPage() {
  const [isCalculating, setIsCalculating] = useState(false);
  const router = useRouter();
  const { setBirthData, setBaziResult, setMbtiResult } = useUserDataStore();
  
  const handleSubmit = async (birthData: BirthData) => {
    setIsCalculating(true);
    
    // æ¨¡æ‹Ÿè®¡ç®—å»¶è¿Ÿ(å®é™…æ˜¯ç¬æ—¶çš„)
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    try {
      // 1. å…«å­—æ’ç›˜
      const baziResult = performBaZiAnalysis(birthData);
      
      // 2. MBTIæ˜ å°„
      const mbtiResult = mapBaZiToMBTI(baziResult);
      
      // 3. å­˜å‚¨ç»“æœ
      setBirthData(birthData);
      setBaziResult(baziResult);
      setMbtiResult(mbtiResult);
      
      // 4. è·³è½¬ç»“æœé¡µ
      router.push('/result');
    } catch (error) {
      console.error('Calculation error:', error);
      alert('Failed to calculate. Please try again.');
      setIsCalculating(false);
    }
  };
  
  if (isCalculating) {
    return <LoadingAnimation />;
  }
  
  return (
    <div className="min-h-screen bg-cyber-dark flex items-center justify-center p-4">
      <BirthInputForm onSubmit={handleSubmit} />
    </div>
  );
}
```

### app/result/page.tsx

```typescript
'use client';
import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useUserDataStore } from '@/store/user-data';
import { SoulprintCard } from '@/components/SoulprintCard';
import { PaymentButton } from '@/components/PaymentButton';
import { ReportRenderer } from '@/components/ReportRenderer';
import { SoulprintCardData } from '@/types/card';
import { getDayMasterImagery } from '@/lib/element-translator';

export default function ResultPage() {
  const router = useRouter();
  const { baziResult, mbtiResult, isPaid, reportContent } = useUserDataStore();
  const [cardData, setCardData] = useState<SoulprintCardData | null>(null);
  
  useEffect(() => {
    // æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨
    if (!baziResult || !mbtiResult) {
      router.push('/input');
      return;
    }
    
    // æ„å»ºå¡ç‰‡æ•°æ®
    setCardData({
      mbti: mbtiResult,
      bazi: baziResult,
      dayMasterImagery: getDayMasterImagery(baziResult.dayMaster),
      powerQuote: 'Depth over speed, flow over force',
      generatedAt: new Date().toISOString(),
      isPremium: isPaid,
    });
  }, [baziResult, mbtiResult, isPaid, router]);
  
  if (!cardData) return null;
  
  return (
    <div className="min-h-screen bg-cyber-dark py-20 px-4">
      <div className="container mx-auto max-w-4xl">
        {/* å¡ç‰‡å±•ç¤º */}
        <div className="mb-12">
          <SoulprintCard data={cardData} hasWatermark={!isPaid} />
        </div>
        
        {/* å…è´¹ç‰ˆ:CTAå‡çº§ */}
        {!isPaid && (
          <div className="bg-gradient-to-r from-cyber-purple/20 to-cyber-accent/20 rounded-xl p-8 text-center mb-12">
            <h2 className="text-3xl font-bold text-white mb-4">
              Unlock Your Full Soul Analysis
            </h2>
            <p className="text-zen-stone mb-6">
              Get a 2000-word AI-generated report covering career, relationships, and growth path
            </p>
            <PaymentButton />
          </div>
        )}
        
        {/* ä»˜è´¹ç‰ˆ:AIæŠ¥å‘Š */}
        {isPaid && reportContent && (
          <div>
            <h2 className="text-2xl font-bold text-cyber-accent mb-6">Your Detailed Report</h2>
            <ReportRenderer content={reportContent} />
          </div>
        )}
      </div>
    </div>
  );
}
```

***

## 7. APIé›†æˆ

### app/api/generate-report/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { GenerateReportRequest, GenerateReportResponse } from '@/types/api';

/**
 * ç”ŸæˆAIæ·±åº¦æŠ¥å‘Š
 * POST /api/generate-report
 */
export async function POST(req: NextRequest) {
  try {
    const body: GenerateReportRequest = await req.json();
    const { baziResult, mbtiResult, paymentId } = body;
    
    // 1. éªŒè¯æ”¯ä»˜çŠ¶æ€(å¯é€‰,MVPé˜¶æ®µå¯å…ˆè·³è¿‡)
    // if (!paymentId) {
    //   return NextResponse.json(
    //     { success: false, error: 'Payment required' },
    //     { status: 403 }
    //   );
    // }
    
    // 2. æ„å»ºPrompt
    const prompt = buildPrompt(baziResult, mbtiResult);
    
    // 3. è°ƒç”¨Vertex AI
    const aiResponse = await callVertexAI(prompt);
    
    // 4. è¿”å›ç»“æœ
    return NextResponse.json<GenerateReportResponse>({
      success: true,
      data: {
        reportContent: aiResponse,
        generatedAt: new Date().toISOString(),
      },
    });
  } catch (error) {
    console.error('Generate report error:', error);
    return NextResponse.json(
      { success: false, error: 'AI generation failed' },
      { status: 500 }
    );
  }
}

/**
 * æ„å»ºAI Prompt
 */
function buildPrompt(bazi: any, mbti: any): string {
  return `
You are "Eastern Echo", a wise sage bridging Ancient Chinese Philosophy and Modern Psychology.

User Profile:
- MBTI Type: ${mbti.type}
- Day Master: ${bazi.dayMaster}
- Dominant Element: ${bazi.dominantElement}
- Energy Distribution: Wood ${bazi.energyScore.wood}%, Fire ${bazi.energyScore.fire}%, Earth ${bazi.energyScore.earth}%, Metal ${bazi.energyScore.metal}%, Water ${bazi.energyScore.water}%

Generate a 2000-word soul analysis with the following sections:

1. **Core Energy (Your Soul Source)**
   - Explain how their elemental balance shapes their core nature
   - Connect to MBTI traits

2. **Career Matrix**
   - Recommend 3 specific career paths
   - Explain why based on their energy blueprint

3. **Love Algorithms**
   - Relationship patterns
   - Compatible types
   - Growth areas

Tone: Mystical yet scientific. Cyber-Zen aesthetic. Empowering, not fatalistic.
  `;
}

/**
 * è°ƒç”¨Vertex AI(éæµå¼)
 */
async function callVertexAI(prompt: string): Promise<string> {
  const endpoint = `https://us-central1-aiplatform.googleapis.com/v1/projects/${process.env.GOOGLE_PROJECT_ID}/locations/us-central1/publishers/google/models/gemini-1.5-pro:predict`;
  
  const response = await fetch(endpoint, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.GOOGLE_VERTEX_API_KEY}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      instances: [{ content: prompt }],
      parameters: {
        temperature: 0.7,
        maxOutputTokens: 2048,
      },
    }),
  });
  
  const data = await response.json();
  return data.predictions[0].content;
}
```

### lib/api-client.ts (å‰ç«¯APIè°ƒç”¨)

```typescript
import axios from 'axios';
import { GenerateReportRequest, GenerateReportResponse, CreemCheckoutRequest, CreemCheckoutResponse } from '@/types/api';

/**
 * è¯·æ±‚ç”ŸæˆAIæŠ¥å‘Š
 */
export async function generateReport(request: GenerateReportRequest): Promise<string> {
  const response = await axios.post<GenerateReportResponse>('/api/generate-report', request);
  
  if (!response.data.success) {
    throw new Error(response.data.error || 'Failed to generate report');
  }
  
  return response.data.data!.reportContent;
}

/**
 * åˆ›å»ºCreem.ioæ”¯ä»˜ä¼šè¯
 */
export async function createPaymentSession(email?: string): Promise<string> {
  const request: CreemCheckoutRequest = {
    productId: process.env.NEXT_PUBLIC_CREEM_PRODUCT_ID!,
    email,
    currency: 'USD',
    successUrl: `${window.location.origin}/result?paid=true`,
    cancelUrl: `${window.location.origin}/result?paid=false`,
  };
  
  const response = await axios.post<CreemCheckoutResponse>(
    'https://api.creem.io/v1/checkouts',
    request,
    {
      headers: {
        'Authorization': `Bearer ${process.env.NEXT_PUBLIC_CREEM_API_KEY}`,
      },
    }
  );
  
  return response.data.checkoutUrl;
}
```

***

## 8. æ ·å¼ç³»ç»Ÿ

### app/globals.css

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  body {
    @apply bg-cyber-dark text-white antialiased;
  }
  
  h1, h2, h3, h4, h5, h6 {
    @apply font-serif;
  }
}

@layer components {
  /* æŒ‰é’®æ ·å¼ */
  .btn-cyber {
    @apply px-6 py-3 bg-cyber-accent text-cyber-dark font-bold rounded-lg;
    @apply hover:scale-105 transition-transform duration-200;
    @apply shadow-lg shadow-cyber-accent/50;
  }
  
  /* å¡ç‰‡æ ·å¼ */
  .card-cyber {
    @apply bg-cyber-dark/80 border border-cyber-sage/30 rounded-xl p-6;
    @apply backdrop-blur-sm;
  }
  
  /* è¾“å…¥æ¡†æ ·å¼ */
  .input-cyber {
    @apply w-full px-4 py-2 bg-cyber-dark border border-cyber-sage rounded-lg;
    @apply text-white placeholder-zen-stone/50;
    @apply focus:border-cyber-accent focus:outline-none;
  }
}

@layer utilities {
  /* å‘å…‰æ•ˆæœ */
  .glow-cyber {
    box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
  }
  
  /* æ–‡æœ¬æ¸å˜ */
  .text-gradient-cyber {
    @apply bg-gradient-to-r from-cyber-accent to-cyber-purple bg-clip-text text-transparent;
  }
}
```

***

## 9. éƒ¨ç½²é…ç½®

### .env.local

```shellscript
# Google Vertex AI
GOOGLE_PROJECT_ID=your-project-id
GOOGLE_VERTEX_API_KEY=your-api-key

# Creem.ioæ”¯ä»˜
NEXT_PUBLIC_CREEM_PRODUCT_ID=prod_soul_report
NEXT_PUBLIC_CREEM_API_KEY=your-creem-api-key

# åº”ç”¨URL
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

### next.config.js

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  images: {
    domains: ['your-cdn-domain.com'],
  },
  // æ€§èƒ½ä¼˜åŒ–
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
}

module.exports = nextConfig
```

### vercel.json

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "regions": ["iad1"],
  "env": {
    "GOOGLE_PROJECT_ID": "@google-project-id",
    "GOOGLE_VERTEX_API_KEY": "@google-vertex-api-key",
    "NEXT_PUBLIC_CREEM_PRODUCT_ID": "@creem-product-id",
    "NEXT_PUBLIC_CREEM_API_KEY": "@creem-api-key"
  }
}
```

***

## 10. å¼€å‘å‘½ä»¤

```shellscript
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
# è®¿é—®: http://localhost:3000

# ç±»å‹æ£€æŸ¥
npm run type-check

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start

# éƒ¨ç½²åˆ°Vercel
vercel --prod
```

***

## ç»“è¯­

æœ¬æ–‡æ¡£æä¾›äº†NatalCodexé¡¹ç›®çš„å®Œæ•´å‰ç«¯å®æ–½æ–¹æ¡ˆã€‚æ‰€æœ‰ä»£ç ç¤ºä¾‹å‡å¯ç›´æ¥ä½¿ç”¨,ç±»å‹å®šä¹‰å®Œæ•´,ä¾¿äºAIç¼–ç¨‹å·¥å…·ç†è§£å’Œç”Ÿæˆä»£ç ã€‚

**ä¸‹ä¸€æ­¥å»ºè®®:**

1. ä½¿ç”¨Cursor/Copilotæ ¹æ®æœ¬æ–‡æ¡£ç”Ÿæˆåˆå§‹ä»£ç æ¡†æ¶
2. ä¼˜å…ˆå®ç°æ ¸å¿ƒæµç¨‹:è¾“å…¥â†’è®¡ç®—â†’ç»“æœå±•ç¤º
3. é€æ­¥æ·»åŠ æ”¯ä»˜å’ŒAIæŠ¥å‘ŠåŠŸèƒ½
4. è¿›è¡Œç§»åŠ¨ç«¯æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

**å…³é”®æ³¨æ„äº‹é¡¹:**

* æ‰€æœ‰æ•æ„ŸAPI Keyå¿…é¡»å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­
* LocalStorageæ•°æ®ç»“æ„è¦ä¿æŒå‘åå…¼å®¹
* Cyber-Zenè§†è§‰é£æ ¼è¦è´¯ç©¿å§‹ç»ˆ
* ç¡®ä¿ç§»åŠ¨ç«¯ä½“éªŒæµç•…(Mobile First)

Good luck building! ğŸš€

***

## 11. å“åº”å¼é€‚é…ä¸ç§»åŠ¨ç«¯ä¼˜åŒ–æ–¹æ¡ˆ

### 11.1 å…³é”®æ–­ç‚¹ç­–ç•¥

#### æ›´æ–° Tailwind é…ç½®ä»¥æ”¯æŒæ›´ç»†ç²’åº¦çš„å“åº”å¼è®¾è®¡

```typescript
// tailwind.config.ts (æ›´æ–°)
export default {
  theme: {
    extend: {
      screens: {
        'xs': '375px',      // è¶…å°å±æ‰‹æœº(iPhone SE)
        'sm': '640px',      // æ ‡å‡†å°å±
        'md': '768px',      // å¹³æ¿ç«–å±
        'lg': '1024px',     // å¹³æ¿æ¨ªå±/å°ç¬”è®°æœ¬
        'xl': '1280px',     // æ¡Œé¢
        '2xl': '1536px',    // å¤§æ¡Œé¢
        '3xl': '1920px',    // è¶…å¤§æ˜¾ç¤ºå™¨
      },
      // è§£å†³ç§»åŠ¨ç«¯è§†å£é«˜åº¦é—®é¢˜
      height: {
        'screen-dvh': '100dvh',  // åŠ¨æ€è§†å£é«˜åº¦(iOS Safariå…¼å®¹)
      },
      minHeight: {
        'screen-dvh': '100dvh',
      },
      maxHeight: {
        'screen-dvh': '100dvh',
      },
      // ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸ
      spacing: {
        'safe-top': 'env(safe-area-inset-top)',
        'safe-bottom': 'env(safe-area-inset-bottom)',
        'safe-left': 'env(safe-area-inset-left)',
        'safe-right': 'env(safe-area-inset-right)',
      },
    }
  }
}
```

### 11.2 ç§»åŠ¨ç«¯ç‰¹æ®Šä¼˜åŒ–

#### A. ç§»åŠ¨ç«¯å®‰å…¨å¸ƒå±€å®¹å™¨

```typescript
// components/Layout/MobileSafeView.tsx
import { ReactNode } from 'react';

interface MobileSafeViewProps {
  children: ReactNode;
  className?: string;
}

/**
 * ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸå®¹å™¨
 * - å¤„ç†iOSåˆ˜æµ·å±/åº•éƒ¨æŒ‡ç¤ºæ¡
 * - è§£å†³è½¯é”®ç›˜é®æŒ¡é—®é¢˜
 * - ä½¿ç”¨åŠ¨æ€è§†å£é«˜åº¦(dvh)é˜²æ­¢åœ°å€æ æ˜¾éšå¯¼è‡´çš„é«˜åº¦è·³åŠ¨
 */
export function MobileSafeView({ children, className = '' }: MobileSafeViewProps) {
  return (
    <div
      className={`
        min-h-screen-dvh w-full
        pt-safe-top pb-safe-bottom
        flex flex-col
        ${className}
      `}
    >
      {children}
    </div>
  );
}
```

#### B. è½¯é”®ç›˜é€‚é…ä¼˜åŒ–

```typescript
// components/BirthInputForm.tsx (å¢å¼ºç‰ˆ)
'use client';
import { useState, useEffect } from 'react';
import { BirthData } from '@/types/bazi';

interface BirthInputFormProps {
  onSubmit: (data: BirthData) => void;
}

export function BirthInputForm({ onSubmit }: BirthInputFormProps) {
  const [isKeyboardOpen, setIsKeyboardOpen] = useState(false);
  
  // æ£€æµ‹è½¯é”®ç›˜çŠ¶æ€(ä»…ç§»åŠ¨ç«¯)
  useEffect(() => {
    const handleResize = () => {
      if (window.visualViewport) {
        const isOpen = window.visualViewport.height < window.innerHeight * 0.75;
        setIsKeyboardOpen(isOpen);
      }
    };
    
    window.visualViewport?.addEventListener('resize', handleResize);
    return () => window.visualViewport?.removeEventListener('resize', handleResize);
  }, []);
  
  return (
    <form className="w-full max-w-md mx-auto px-4">
      {/* è¡¨å•å­—æ®µ */}
      <div className="space-y-4">
        {/* æ—¥æœŸè¾“å…¥å»ºè®®ä½¿ç”¨åŸç”Ÿæ§ä»¶ */}
        <input
          type="date"
          className="input-cyber"
          // ç§»åŠ¨ç«¯è‡ªåŠ¨ä½¿ç”¨åŸç”Ÿæ—¥æœŸé€‰æ‹©å™¨
        />
        
        {/* æ—¶é—´é€‰æ‹© */}
        <input
          type="time"
          className="input-cyber"
        />
      </div>
      
      {/* æäº¤æŒ‰é’® - ç§»åŠ¨ç«¯å›ºå®šåº•éƒ¨ */}
      <button
        type="submit"
        className={`
          btn-cyber w-full mt-6
          md:relative md:bottom-auto
          ${
            isKeyboardOpen
              ? 'fixed bottom-4 left-4 right-4 z-50'  // é”®ç›˜æ‰“å¼€æ—¶å›ºå®šåœ¨å¯è§åŒºåŸŸ
              : 'sticky bottom-4'                     // é”®ç›˜å…³é—­æ—¶ç²˜æ€§å®šä½
          }
        `}
      >
        å¼€å§‹è§£æ
      </button>
    </form>
  );
}
```

#### C. è§¦æ‘¸ä¼˜åŒ–

```css
/* app/globals.css (æ–°å¢) */
@layer base {
  /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
  @media (hover: none) and (pointer: coarse) {
    /* æ‰€æœ‰äº¤äº’å…ƒç´ æœ€å°è§¦æ‘¸åŒºåŸŸ 44x44px (Apple HIGæ ‡å‡†) */
    button, a, input, select {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* ç¦ç”¨é•¿æŒ‰é€‰æ‹©æ–‡æœ¬(é¿å…è¯¯è§¦) */
    * {
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
    }
    
    /* è¾“å…¥æ¡†å…è®¸é€‰æ‹© */
    input, textarea {
      -webkit-user-select: text;
      user-select: text;
    }
    
    /* ç§»é™¤ç‚¹å‡»é«˜äº® */
    * {
      -webkit-tap-highlight-color: transparent;
    }
  }
  
  /* æ¡Œé¢ç«¯æ¢å¤é»˜è®¤è¡Œä¸º */
  @media (hover: hover) and (pointer: fine) {
    * {
      -webkit-user-select: auto;
      user-select: auto;
    }
  }
}
```

### 11.3 å¤æ‚ç»„ä»¶å“åº”å¼é™çº§

#### ElementRadar é›·è¾¾å›¾ç§»åŠ¨ç«¯ä¼˜åŒ–

```typescript
// components/ElementRadar.tsx (å¢å¼ºç‰ˆ)
import { motion } from 'framer-motion';
import { useState } from 'react';

interface ElementRadarProps {
  energyScore: {
    wood: number;
    fire: number;
    earth: number;
    metal: number;
    water: number;
  };
  size?: number;
}

export function ElementRadar({ energyScore, size = 200 }: ElementRadarProps) {
  const [showDetail, setShowDetail] = useState(false);
  const isMobile = typeof window !== 'undefined' && window.innerWidth < 768;
  
  const elements = [
    { name: 'Wood', value: energyScore.wood, color: '#52b788', angle: 0 },
    { name: 'Fire', value: energyScore.fire, color: '#e63946', angle: 72 },
    { name: 'Earth', value: energyScore.earth, color: '#ca6702', angle: 144 },
    { name: 'Metal', value: energyScore.metal, color: '#d4d4d8', angle: 216 },
    { name: 'Water', value: energyScore.water, color: '#219ebc', angle: 288 },
  ];
  
  return (
    <div className="relative w-full">
      {/* ç§»åŠ¨ç«¯ç®€åŒ–æ˜¾ç¤º */}
      <div className="md:hidden">
        <svg 
          width="100%" 
          height="auto" 
          viewBox={`0 0 ${size} ${size}`}
          onClick={() => setShowDetail(!showDetail)}
          className="touch-none"  // é˜²æ­¢è¯¯è§¦æ»šåŠ¨
        >
          {/* æ•°æ®åŒºåŸŸ(éšè—ç½‘æ ¼é™ä½è§†è§‰å¤æ‚åº¦) */}
          <motion.path
            d={generatePath()}
            fill="rgba(0, 255, 157, 0.3)"
            stroke="#00ff9d"
            strokeWidth="3"  // ç§»åŠ¨ç«¯åŠ ç²—çº¿æ¡
            initial={{ pathLength: 0 }}
            animate={{ pathLength: 1 }}
            transition={{ duration: 1, ease: 'easeOut' }}
          />
        </svg>
        
        {/* ç§»åŠ¨ç«¯æ•°å€¼æç¤º */}
        {showDetail && (
          <div className="mt-2 grid grid-cols-5 gap-1 text-xs">
            {elements.map((el) => (
              <div key={el.name} className="text-center">
                <div 
                  className="w-3 h-3 rounded-full mx-auto mb-1"
                  style={{ backgroundColor: el.color }}
                />
                <div className="text-white/80">{el.name}</div>
                <div className="font-bold text-cyber-accent">{el.value}</div>
              </div>
            ))}
          </div>
        )}
        
        <p className="text-xs text-center text-gray-400 mt-2">
          ğŸ‘† ç‚¹å‡»æŸ¥çœ‹æ•°å€¼
        </p>
      </div>
      
      {/* æ¡Œé¢ç«¯å®Œæ•´æ˜¾ç¤º */}
      <div className="hidden md:block">
        <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>
          {/* å®Œæ•´ç½‘æ ¼ */}
          {[0.2, 0.4, 0.6, 0.8, 1].map((scale) => (
            <polygon
              key={scale}
              points={elements.map((el) => {
                const center = size / 2;
                const radius = (size / 2) * 0.8 * scale;
                const angleRad = (el.angle * Math.PI) / 180;
                const x = center + radius * Math.cos(angleRad - Math.PI / 2);
                const y = center + radius * Math.sin(angleRad - Math.PI / 2);
                return `${x},${y}`;
              }).join(' ')}
              fill="none"
              stroke="rgba(255,255,255,0.1)"
              strokeWidth="1"
            />
          ))}
          
          {/* æ•°æ®åŒºåŸŸ */}
          <motion.path
            d={generatePath()}
            fill="rgba(0, 255, 157, 0.3)"
            stroke="#00ff9d"
            strokeWidth="2"
            initial={{ pathLength: 0 }}
            animate={{ pathLength: 1 }}
            transition={{ duration: 1, ease: 'easeOut' }}
          />
          
          {/* æ¡Œé¢ç«¯æ˜¾ç¤ºæ ‡ç­¾ */}
          {elements.map((el) => {
            const center = size / 2;
            const radius = (size / 2) * 0.95;
            const angleRad = (el.angle * Math.PI) / 180;
            const x = center + radius * Math.cos(angleRad - Math.PI / 2);
            const y = center + radius * Math.sin(angleRad - Math.PI / 2);
            return (
              <text
                key={el.name}
                x={x}
                y={y}
                fill={el.color}
                fontSize="14"
                textAnchor="middle"
                dominantBaseline="middle"
              >
                {el.name} ({el.value})
              </text>
            );
          })}
        </svg>
      </div>
    </div>
  );
  
  function generatePath() {
    const center = size / 2;
    const maxRadius = (size / 2) * 0.8;
    const points = elements.map((el) => {
      const radius = (el.value / 100) * maxRadius;
      const angleRad = (el.angle * Math.PI) / 180;
      const x = center + radius * Math.cos(angleRad - Math.PI / 2);
      const y = center + radius * Math.sin(angleRad - Math.PI / 2);
      return `${x},${y}`;
    });
    return `M ${points.join(' L ')} Z`;
  }
}
```

### 11.4 æ¡Œé¢ç«¯å¢å¼ºä½“éªŒ

#### Hover æ€ä¸äº¤äº’æç¤º

```typescript
// components/FeatureCard.tsx (å¢å¼ºç‰ˆ)
import { motion } from 'framer-motion';

interface FeatureCardProps {
  title: string;
  description: string;
  icon: string;
}

export function FeatureCard({ title, description, icon }: FeatureCardProps) {
  return (
    <motion.div
      whileHover={{ scale: 1.05, y: -8 }}  // æ¡Œé¢ç«¯HoveråŠ¨ç”»
      className="
        bg-cyber-dark/50 border border-cyber-sage/30 rounded-xl p-6
        hover:border-cyber-accent hover:shadow-xl hover:shadow-cyber-accent/20
        transition-all duration-300
        cursor-pointer
        group
      "
    >
      <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">
        {icon}
      </div>
      <h3 className="text-xl font-bold text-white mb-2">{title}</h3>
      <p className="text-zen-stone group-hover:text-white transition-colors">
        {description}
      </p>
      
      {/* æ¡Œé¢ç«¯æ˜¾ç¤ºã€Œäº†è§£æ›´å¤šã€æç¤º */}
      <div className="hidden md:block mt-4 text-sm text-cyber-accent opacity-0 group-hover:opacity-100 transition-opacity">
        äº†è§£æ›´å¤š â†’
      </div>
    </motion.div>
  );
}
```

### 11.5 å“åº”å¼æµ‹è¯•æ¸…å•

#### å¿…æµ‹è®¾å¤‡ä¸æµè§ˆå™¨ç»„åˆ

```markdown
# å“åº”å¼æµ‹è¯•æ¸…å•

## ç§»åŠ¨ç«¯ (375px - 768px)
- [ ] iPhone SE (375x667) - Safari
- [ ] iPhone 13 Pro (390x844) - Safari
- [ ] Android æ ‡å‡† (360x640) - Chrome
- [ ] iPad Mini (768x1024) - Safari

### å…³é”®æµ‹è¯•ç‚¹
- [ ] è½¯é”®ç›˜å¼¹å‡ºæ—¶æäº¤æŒ‰é’®å¯è§
- [ ] æ—¥æœŸ/æ—¶é—´é€‰æ‹©å™¨è°ƒç”¨åŸç”Ÿæ§ä»¶
- [ ] é›·è¾¾å›¾ä¸æº¢å‡º,æ•°å€¼å¯è§
- [ ] è§¦æ‘¸åŒºåŸŸâ‰¥44x44px
- [ ] æ¨ªå±æ¨¡å¼æ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢æ»šåŠ¨æµç•…(60fps)

## æ¡Œé¢ç«¯ (1024px+)
- [ ] MacBook Pro 13" (1440x900) - Chrome/Safari
- [ ] Windows ç¬”è®°æœ¬ (1920x1080) - Chrome/Edge
- [ ] 4Kæ˜¾ç¤ºå™¨ (3840x2160) - ç¼©æ”¾150%

### å…³é”®æµ‹è¯•ç‚¹
- [ ] Hoveræ€åé¦ˆæ˜æ˜¾
- [ ] ä¸‰åˆ—å¸ƒå±€å¯¹é½
- [ ] é¼ æ ‡æ»šè½®æµç•…
- [ ] å¿«æ·é”®æ”¯æŒ(Tabå¯¼èˆª)
```

### 11.6 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### ç§»åŠ¨ç«¯æ€§èƒ½å…³é”®æŒ‡æ ‡

```typescript
// next.config.js (å¢å¼ºç‰ˆ)
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  
  // ç§»åŠ¨ç«¯ä¼˜å…ˆä¼˜åŒ–
  images: {
    domains: ['your-cdn-domain.com'],
    deviceSizes: [375, 640, 768, 1024, 1280],  // ç²¾ç¡®åŒ¹é…å¸¸ç”¨è®¾å¤‡
    imageSizes: [16, 32, 48, 64, 96],
    formats: ['image/avif', 'image/webp'],     // ä¼˜å…ˆAVIF(ä½“ç§¯å‡å°‘50%)
  },
  
  // æ€§èƒ½ä¼˜åŒ–
  compiler: {
    removeConsole: process.env.NODE_ENV === 'production',
  },
  
  // ç§»åŠ¨ç«¯é¢„åŠ è½½ä¼˜åŒ–
  experimental: {
    optimizeCss: true,           // CSSä¼˜åŒ–
    scrollRestoration: true,     // æ»šåŠ¨ä½ç½®æ¢å¤
  },
}

module.exports = nextConfig
```

#### å…³é”®æ€§èƒ½æŒ‡æ ‡(Web Vitals)

```markdown
# æ€§èƒ½ç›®æ ‡ (ç§»åŠ¨ç«¯ 4G)
- LCP (Largest Contentful Paint): < 2.5s
- FID (First Input Delay): < 100ms
- CLS (Cumulative Layout Shift): < 0.1

# ä¼˜åŒ–ç­–ç•¥
1. é¦–å±åŠ è½½:
   - Landing Page < 1.5s (å…³é”®CSSå†…è”)
   - é›·è¾¾å›¾ç»„ä»¶æ‡’åŠ è½½
   
2. äº¤äº’å“åº”:
   - æŒ‰é’®ç‚¹å‡»åé¦ˆ < 50ms (ä½¿ç”¨transformè€Œélayoutå±æ€§)
   - é¡µé¢åˆ‡æ¢ä½¿ç”¨é¢„åŠ è½½(next/linkè‡ªåŠ¨é¢„å–)
   
3. è§†è§‰ç¨³å®š:
   - æ‰€æœ‰å›¾ç‰‡é¢„è®¾å°ºå¯¸
   - å­—ä½“ä½¿ç”¨fallbacké˜²æ­¢FOIT
```

